<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>车载通用播放器</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; font-family: sans-serif; }
        
        /* 输入框容器 (未播放时显示) */
        #input-box {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            max-width: 500px;
            text-align: center;
            z-index: 20;
        }
        
        input {
            width: 100%;
            padding: 15px;
            border-radius: 8px;
            border: none;
            margin-bottom: 15px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 16px;
        }
        
        button {
            padding: 12px 30px;
            background: #e50914; /* 奈飞红 */
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        /* 播放器容器 - 核心防屏蔽设置 */
        #mse {
            width: 100% !important;
            height: 100% !important;
            background: #000;
            display: none; /* 初始隐藏 */
        }

        /* 强制伪全屏样式 - 覆盖所有浏览器UI */
        .xgplayer-is-fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
        }
    </style>
    
    <script src="//unpkg.com/xgplayer@2.31.6/browser/index.js"></script>
    <script src="//unpkg.com/xgplayer-hls.js/dist/index.min.js"></script>
</head>
<body>

    <div id="input-box">
        <h3 style="color: #fff; margin-bottom: 20px;">输入 m3u8 链接</h3>
        <input type="text" id="urlInput" placeholder="https://example.com/video.m3u8">
        <button onclick="startPlay()">开始播放</button>
    </div>

    <div id="mse"></div>

    <script>
        let player = null;

        // 自动检测 URL 参数
        // 用法: https://你的域名/play.html?url=你的m3u8链接
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            const urlFromParam = params.get('url');
            if (urlFromParam) {
                document.getElementById('urlInput').value = urlFromParam;
                startPlay(urlFromParam);
            }
        }

        function startPlay(directUrl) {
            const url = directUrl || document.getElementById('urlInput').value.trim();
            if (!url) return alert('请输入链接');

            // 隐藏输入框，显示播放器
            document.getElementById('input-box').style.display = 'none';
            const mse = document.getElementById('mse');
            mse.style.display = 'block';

            // 初始化西瓜播放器
            player = new Player({
                id: 'mse',
                url: url,
                playsinline: true,    // 【核心】车载防封必开
                whitelist: [''],      // 允许所有设备
                autoplay: true,       // 尝试自动播放
                fluid: true,          // 流式布局
                fitVideoSize: 'auto', // 自适应尺寸
                volume: 0.8,
                
                // 开启 HLS 支持
                plugins: [window.HlsJsPlugin],
                hls: {
                    retryCount: 3, // 断连重试次数
                },

                // 播放器自定义配置
                playbackRate: [0.5, 0.75, 1, 1.25, 1.5, 2], // 倍速
                pip: false,           // 车载通常不支持画中画，关掉
                cssFullscreen: true,  // 【核心】使用网页样式全屏，而非系统全屏
            });

            // 监听错误，自动重试
            player.on('error', () => {
                console.log('播放出错，尝试重载...');
                // 可以在这里加重连逻辑
            });
            
            // 也是为了防封，一旦播放，尝试进入“网页全屏”模式
            player.once('play', () => {
                if(player.getCssFullscreen) {
                    player.getCssFullscreen(); 
                }
            });
        }
    </script>
</body>
</html>
