<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tesla Base64 Player</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; }
        #app-frame { width: 100vw; height: 100vh; border: none; display: block; background: #000; }
        /* 全局调试层 */
        #global-log {
            position: fixed; top: 0; left: 0; width: 100%; z-index: 9999;
            background: rgba(0,0,0,0.8); color: lime; font-family: monospace;
            padding: 10px; pointer-events: none; font-size: 12px;
        }
    </style>
</head>
<body>

<div id="global-log">主程序启动...</div>
<iframe id="app-frame" allow="autoplay; encrypted-media; fullscreen" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>

<script>
    const logDiv = document.getElementById('global-log');
    function log(msg) { logDiv.innerText = msg; console.log(msg); }

    // 你的资源
    const V_URL = "https://vod.360zyx.vip/20251018/eT501sKw/index.m3u8";

    // 备用资源 (如果你的那个坏了，用这个测)
    const TEST_URL = "https://test-streams.mux.dev/x36xhzz/x36xhzz.m3u8";

    window.onload = function() {
        log("正在构建 Base64 播放器...");

        // 这是一个极其精简的 HTML 结构，没有任何多余的库
        const innerHTML = `
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<style>
    body{margin:0;background:#000;color:#fff;display:flex;justify-content:center;align-items:center;height:100vh}
    video{width:100%;height:100%;object-fit:contain}
    #info{position:absolute;top:50px;left:10px;color:yellow;z-index:100;background:rgba(0,0,0,0.5)}
    button{position:absolute;z-index:200;padding:20px 40px;font-size:20px;background:red;color:white;border:none;border-radius:10px;cursor:pointer}
</style>
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.0/dist/hls.min.js"><\/script>
</head>
<body>
    <div id="info">等待指令...</div>
    <video id="v" playsinline webkit-playsinline controls></video>
    <button id="btn" onclick="start()">点击播放 (D档)</button>

    <script>
        const v = document.getElementById('v');
        const info = document.getElementById('info');
        const btn = document.getElementById('btn');
        const url = "${V_URL}"; // 使用你的链接

        function msg(t) { info.innerText = t; }

        window.start = function() {
            btn.style.display = 'none';
            msg("正在解析 HLS流...");
            
            if (Hls.isSupported()) {
                const hls = new Hls({
                    debug: false,
                    enableWorker: true,
                    // 核心：强制允许跨域
                    xhrSetup: function(xhr) { xhr.withCredentials = false; }
                });
                
                hls.loadSource(url);
                hls.attachMedia(v);
                
                hls.on(Hls.Events.MANIFEST_PARSED, function() {
                    msg("解析成功，尝试播放...");
                    v.play().catch(e => {
                        msg("自动播放失败: " + e.message);
                        btn.style.display = 'block';
                        btn.innerText = "重试播放";
                    });
                });
                
                hls.on(Hls.Events.ERROR, function(event, data) {
                    msg("HLS错误: " + data.type + " - " + data.details);
                    if (data.fatal) {
                        switch (data.type) {
                            case Hls.ErrorTypes.NETWORK_ERROR:
                                msg("致命错误: 网络连接失败 (可能源挂了)");
                                hls.startLoad();
                                break;
                            case Hls.ErrorTypes.MEDIA_ERROR:
                                msg("致命错误: 媒体解码失败");
                                hls.recoverMediaError();
                                break;
                            default:
                                hls.destroy();
                                break;
                        }
                    }
                });
                
                // 监听状态
                v.addEventListener('playing', () => msg("状态: 播放中 (D档请观察是否黑屏)"));
                v.addEventListener('waiting', () => msg("状态: 缓冲中..."));
                
            } else if (v.canPlayType('application/vnd.apple.mpegurl')) {
                // 针对 Safari / 原生支持的环境
                v.src = url;
                v.play();
            } else {
                msg("错误: 你的浏览器完全不支持 HLS");
            }
        }
    <\/script>
</body>
</html>
        `;

        const frame = document.getElementById('app-frame');
        
        // 使用 srcdoc (特斯拉浏览器 Chrome 109+ 支持这个，比 Blob 更稳)
        frame.srcdoc = innerHTML;
        
        log("播放器注入完成，请点击屏幕中央红按钮");
    };
</script>
</body>
</html>
