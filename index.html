<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tesla XG-Iframe</title>
    <style>
        /* 主页面仅仅是一个黑色外壳，什么都没有 */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; }
        
        /* 全屏 Iframe 容器 */
        #app-frame {
            width: 100vw;
            height: 100vh;
            border: none;
            display: block;
        }
    </style>
</head>
<body>

    <iframe id="app-frame" allow="autoplay; encrypted-media; fullscreen" sandbox="allow-scripts allow-same-origin allow-forms"></iframe>

<script>
    // --- 配置 ---
    // 你的测试源
    const VIDEO_URL = "https://vod.360zyx.vip/20251018/eT501sKw/index.m3u8";

    // --- 虚拟页面的 HTML 代码 ---
    // 这段代码实际上是运行在 Iframe 内部的
    const innerHTML = `
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <style>
            body { margin: 0; background: #000; color: #fff; display: flex; align-items: center; justify-content: center; height: 100vh; overflow: hidden; font-family: sans-serif; }
            #player { width: 100%; height: 100%; }
            
            /* 简单的控制层，防止无法交互 */
            .tips { position: absolute; top: 10px; left: 10px; z-index: 100; font-size: 12px; color: rgba(255,255,255,0.5); pointer-events: none; }
        </style>
        <script src="https://unpkg.com/xgplayer@2.31.2/browser/index.js"><\/script>
        <script src="https://unpkg.com/xgplayer-hls@2.5.2/dist/index.min.js"><\/script>
    </head>
    <body>
        <div class="tips">XGPlayer Core (Iframe Mode)</div>
        <div id="player"></div>

        <script>
            // 等待资源加载
            window.onload = function() {
                // 初始化 XGPlayer
                let player = new window.HlsJsPlayer({
                    id: 'player',
                    url: '${VIDEO_URL}',
                    playsinline: true,
                    whitelist: [''], // 允许在任何设备播放
                    autoplay: true,
                    fluid: true,     // 流式布局，填满容器
                    fitVideoSize: 'auto',
                    volume: 1.0,
                    // 关键配置：开启 MSE 硬解，而不是原生 Video 标签播放
                    useHls: true, 
                    hlsOpts: {
                        enableWorker: true // 开启多线程解码
                    },
                    ignores: ['fullscreen'] // 禁用自带全屏，防止触发车机拦截
                });

                // 强制重试机制
                player.on('error', function() {
                    console.log('播放出错，尝试重载...');
                    player.reload();
                });
                
                // 点击屏幕任意位置播放/暂停
                document.body.addEventListener('click', function() {
                    if(player.paused) player.play();
                    else player.pause();
                });
            }
        <\/script>
    </body>
    </html>
    `;

    // --- 注入逻辑 ---
    window.onload = function() {
        const frame = document.getElementById('app-frame');
        // 使用 srcdoc 将上面的代码注入到 iframe 中
        // 这相当于你的网页里“套”了另一个独立的微型网页
        frame.srcdoc = innerHTML;
    };
</script>
</body>
</html>
