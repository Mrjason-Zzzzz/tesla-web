<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ç‰¹æ–¯æ‹‰è§‚å½±æœç´¢</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; color: #fff; font-family: sans-serif; padding: 20px; }
        .api-select { margin-bottom: 15px; padding: 10px; background: #111; border-radius: 8px; }
        .api-select label { font-size: 14px; margin-right: 10px; }
        .api-select select { padding: 5px 10px; background: #222; color: #fff; border: 1px solid #444; border-radius: 4px; }
        .search-box { display: flex; gap: 10px; margin-bottom: 20px; }
        #searchInput { 
            flex: 1; 
            padding: 12px 15px; 
            border: 1px solid #333; 
            border-radius: 8px; 
            background: #111; 
            color: #fff; 
            font-size: 16px; 
            height: 48px; /* ç‰¹æ–¯æ‹‰è§¦æ§ä¼˜åŒ–ï¼šæ”¾å¤§è¾“å…¥æ¡† */
        }
        #searchBtn { 
            padding: 0 20px; 
            border: none; 
            border-radius: 8px; 
            background: #0071e3; 
            color: #fff; 
            font-size: 16px; 
            cursor: pointer; 
            height: 48px; /* ç‰¹æ–¯æ‹‰è§¦æ§ä¼˜åŒ–ï¼šæ”¾å¤§æŒ‰é’® */
        }
        #loading { text-align: center; color: #999; font-size: 16px; display: none; }
        #resultList { margin-top: 20px; display: none; }
        .result-item { 
            background: #111; 
            padding: 15px; 
            border-radius: 8px; 
            margin-bottom: 10px; 
            cursor: pointer; 
            touch-action: manipulation; /* ç‰¹æ–¯æ‹‰è§¦æ§ä¼˜åŒ–ï¼šæ¶ˆé™¤ç‚¹å‡»å»¶è¿Ÿ */
        }
        .result-title { font-size: 18px; margin-bottom: 8px; }
        .result-desc { font-size: 14px; color: #999; }
        .error { text-align: center; color: #ff4444; font-size: 16px; margin-top: 20px; display: none; }
    </style>
</head>
<body>
    <!-- è§£ææºé€‰æ‹©ï¼ˆå…¼å®¹ä½ æä¾›çš„JSONé…ç½®ï¼‰ -->
    <div class="api-select">
        <label>é€‰æ‹©è§£ææºï¼š</label>
        <select id="apiSelector">
            <option value="http://110.42.70.165:12121/api.php/provide/vod/?ac=detail&wd=">å®˜é“¾|Mac</option>
            <option value="https://caiji.maotaizy.cc/api.php/provide/vod/?ac=detail&wd=">èŒ…å°|zyz</option>
            <option value="https://cj.rycjapi.com/api.php/provide/vod/?ac=detail&wd=">å¦‚æ„|zyz</option>
            <option value="https://jszyapi.com/api.php/provide/vod/?ac=detail&wd=">æé€Ÿ|zyz</option>
            <option value="https://iqiyizyapi.com/api.php/provide/vod/?ac=detail&wd=">æš´é£|zyz</option>
        </select>
    </div>

    <div class="search-box">
        <input type="text" id="searchInput" placeholder="è¾“å…¥è§†é¢‘åç§°ï¼ˆå¦‚ï¼šå“ªå’ã€æµæµªåœ°çƒï¼‰">
        <button id="searchBtn">æœç´¢</button>
    </div>
    <div id="loading">æ­£åœ¨æœç´¢è§†é¢‘...</div>
    <div id="error">æœç´¢å¤±è´¥ï¼Œè¯·åˆ‡æ¢è§£ææºé‡è¯•</div>
    <div id="resultList"></div>

    <script>
        // æ’­æ”¾é¡µåœ°å€ï¼ˆå¯¹åº”index.htmlï¼‰
        const PLAY_PAGE = "index.html";

        // ğŸ”¥ æ ¸å¿ƒä¿®æ”¹1ï¼šæ›¿æ¢ä¸ºå¯ç”¨çš„è·¨åŸŸä»£ç†ï¼ˆè§£å†³Failed to fetchï¼‰
        function getProxyUrl(url) {
            return `https://cors-anywhere.herokuapp.com/${url}`;
        }

        // æ ¸å¿ƒï¼šæœç´¢è§†é¢‘ï¼ˆé€‚é…ç‰¹æ–¯æ‹‰è½¦æœºç½‘ç»œï¼‰
        async function searchVideo(keyword) {
            if (!keyword) {
                alert("è¯·è¾“å…¥è§†é¢‘åç§°");
                return;
            }

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultList').style.display = 'none';
            document.getElementById('error').style.display = 'none';

            try {
                // è·å–é€‰ä¸­çš„è§£ææº
                const selectedApi = document.getElementById('apiSelector').value;
                // æ‹¼æ¥æœç´¢URL
                const rawSearchUrl = selectedApi + encodeURIComponent(keyword);
                // è·¨åŸŸä»£ç†è®¿é—®
                const proxyUrl = getProxyUrl(rawSearchUrl);
                
                // å‘èµ·è¯·æ±‚ï¼ˆå¸¦ç‰¹æ–¯æ‹‰å…¼å®¹çš„UAï¼‰
                const response = await fetch(proxyUrl, {
                    headers: {
                        'User-Agent': "Mozilla/5.0 (compatible; Baiduspider/2.0; +http://www.baidu.com/search/spider.html)",
                        'Cache-Control': 'no-cache' // é¿å…ç‰¹æ–¯æ‹‰è½¦æœºç¼“å­˜æ—§æ•°æ®
                    },
                    timeout: 10000 // è¶…æ—¶10ç§’ï¼Œé€‚é…è½¦æœºç½‘ç»œ
                });

                // ğŸ”¥ æ ¸å¿ƒä¿®æ”¹2ï¼šç›´æ¥è§£æAPIè¿”å›æ•°æ®ï¼ˆæ— éœ€å†è§£æcontentsï¼‰
                const apiData = await response.json();
                const videoList = apiData.list || apiData.data || apiData.vod_list || [];

                // æ— ç»“æœå¤„ç†
                if (videoList.length === 0) {
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('error').innerText = "æœªæ‰¾åˆ°ç›¸å…³è§†é¢‘ï¼Œå¯åˆ‡æ¢è§£ææºé‡è¯•";
                    document.getElementById('error').style.display = 'block';
                    return;
                }

                // æ¸²æŸ“æœç´¢ç»“æœ
                renderResult(videoList);
            } catch (e) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').innerText = `æœç´¢å¤±è´¥ï¼š${e.message}\nå»ºè®®åˆ‡æ¢è§£ææºæˆ–ç¨åé‡è¯•`;
                document.getElementById('error').style.display = 'block';
                console.log("è°ƒè¯•ä¿¡æ¯ï¼š", e); // æ–¹ä¾¿æ’æŸ¥é—®é¢˜
            }
        }

        // æ¸²æŸ“æœç´¢ç»“æœï¼ˆç‰¹æ–¯æ‹‰è§¦æ§å‹å¥½ï¼‰
        function renderResult(videoList) {
            document.getElementById('loading').style.display = 'none';
            const resultList = document.getElementById('resultList');
            resultList.innerHTML = "";

            videoList.forEach(item => {
                // æå–M3U8æ’­æ”¾åœ°å€ï¼ˆå…¼å®¹å¤šçº¿è·¯æ ¼å¼ï¼‰
                const playUrl = item.play_url || item.vod_play_url || item.url || "";
                if (!playUrl) return;

                // æå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆM3U8åœ°å€
                let m3u8Url = playUrl.split("$")[1] || playUrl;
                if (!m3u8Url.includes('.m3u8')) return;

                // åˆ›å»ºç»“æœé¡¹
                const itemDiv = document.createElement('div');
                itemDiv.className = 'result-item';
                // ç‚¹å‡»è·³è½¬åˆ°æ’­æ”¾é¡µï¼ˆç‰¹æ–¯æ‹‰è§¦æ§æ— å»¶è¿Ÿï¼‰
                itemDiv.onclick = () => {
                    window.location.href = `${PLAY_PAGE}?url=${encodeURIComponent(m3u8Url)}`;
                };

                // è§†é¢‘æ ‡é¢˜
                const titleDiv = document.createElement('div');
                titleDiv.className = 'result-title';
                titleDiv.innerText = item.name || item.vod_name || item.title || "æœªçŸ¥è§†é¢‘";

                // è§†é¢‘åˆ†ç±»
                const descDiv = document.createElement('div');
                descDiv.className = 'result-desc';
                descDiv.innerText = item.type || item.vod_type || "æ— åˆ†ç±»";

                itemDiv.appendChild(titleDiv);
                itemDiv.appendChild(descDiv);
                resultList.appendChild(itemDiv);
            });

            resultList.style.display = 'block';
        }

        // ç»‘å®šæœç´¢æŒ‰é’®äº‹ä»¶
        document.getElementById('searchBtn').addEventListener('click', () => {
            const keyword = document.getElementById('searchInput').value.trim();
            searchVideo(keyword);
        });

        // å›è½¦æœç´¢ï¼ˆç‰¹æ–¯æ‹‰é”®ç›˜é€‚é…ï¼‰
        document.getElementById('searchInput').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                const keyword = e.target.value.trim();
                searchVideo(keyword);
            }
        });
    </script>
</body>
</html>
